# 光源
- 平行光的辐照度如何计算
  -  计算在垂直于l(光源的方向)的单位面积上单位时间内穿过的能量
  
- 光照模型物体表面的辐照度
  - 计算光源方向l和表面法线n之间的夹角的余弦值.
  - 辐照度和照射到物体表面时光线之间的距离d/cosθ成反比,即辐照度与cosθ成正比
  - cosθ通过光源方向l和表面法线n的点积来得到
  
  
# 吸收与散射
- 吸收与散射的区别
  - 吸收只改变光线的密度和颜色,不改变光线的方向
  - 散射只改变光线的方向,不改变光线的密度和颜色

- 散射改变光线方向的两种情况
  - 散射到物体内部即折射或透射
  - 散射到外部即反射
  
- 光照模型如何表现散射的两种的不同方向
  - 高光反射部分表示物体表面是如何反射光线的
  - 漫反射部分表示由多少光线会被折射,吸收和散射出表面
  
  
- 出射度
  - 根据入射光线的数量和方向计算出出射光线的数量和方向
  - 出射度与辐照度满足线性关系,它们之间的比值就是材质的漫反射和高光反射属性
  
- 着色的定义
  - 根据材质属性(如漫反射属性),光源信息(光源方向,辐照度)使用一个等式去计算沿某个观察方向的出射度的过程
  
- BRDF的定义
  - 当给定入射光线的方向和辐照度后,BRDF可以给出在某个出射方向上的光照能量分布
  
  
# 标准光照模型
- 概念
  - 只关心直接光照(direct light)直接从光源发射出来照射到物体表面后经过物体表面的一次反射直接进入摄像机的光线
  
- 实现
  - 将进入到摄像机内的光线分为4部分,每个部分使用一种方法来计算它的贡献度
  - 自发光(Cmissive)
	- 当给定一个方向时,一个表面本身会向该方向发射多少辐射量。如果没有使用全局光照技术,这些自发光的表面不会照亮周围物体,只是本身看起来更亮
	- 光线直接由光源发射进入摄像机,不经过任何物体反射,通过自发光来计算这部分贡献度
  - 高光反射(Cspecular)
    - 光线从光源照射到模型表面时,该表面会在完全镜面反射方向散射多少辐射量
	- 当物体的表面很光滑,在一定的角度范围观察这个平滑的表面,能够看到一个高光效果
	- 镜面反射效果与观察方向是有关的,当观察方向和光的反射方向越近的时候,观察到的镜面反射效果越强
  - 漫发射(Cdiffuse)
    - 当光线从光源照射到模型表面时,该表面会向每个方向散射出多少辐射量
	- 漫反射中,视角位置不重要,因为反射完全随机即在任何反射方向的分布都是一样的
	- 与入射光线的角度有关
	- 符号兰伯特定律:反射的强度与表面法线和光源方向之间夹角的余弦值成正比
	- Cdiffuse = (Clight * Mdiffuse)max(0,n * l) n是表面法线 l指向光源的单位矢量 Mdiffuse材质的漫反射颜色 Clighe是光源的颜色
	- 防止物体被从后面来的光源照亮用max函数将其截取到0
  - 环境光(Cambient)
    - 描述其他所有的间接光照
	- 环境光通常是一个全局变量,场景中所有物体都使用这个环境光
	
	
- 镜面反射phong与Blinn - Phong的区别
  - phong 
    - 用反射光的方向向量和观察方向的方向向量做点乘,得到其夹角的余弦值,点乘的结果越大,则反射光和观察方向就越近
  - Blinn - Phong
    - 计算半程向量h和该平面的法向量n的远近。因为反射光和观察方向越近，半程向量和法向量也就越近，且计算反射光的计算量比较大，而半程向量h只需要将v和l相加，
	  再标准化即可得到，计算简单。
	  
- 标准光照的计算公式通过下面地址截图
  - https://www.pianshen.com/article/15671428680/
  
- 逐像素与逐顶点
  - 逐像素 片元着色器中计算
	- 以每个像素为基础,得到它的法线(对顶点法线插值或者从法线纹理中采样)进行模型光照计算.
	- 在面片之间对顶点法线进行插值的技术成为Phong着色,phong插值或者法线插值着色技术
  - 逐顶点 顶点着色器中计算
	- 在每个顶点上面计算光照,在渲染图元内部进行线性插值,最后输出成像素的颜色Gouraud着色
	
- Flat Shading / Gouraud Shading / Phong Shading 区别
  - Flat Shading 在一个三角形上取一个点进行着色,将这个点作为该面的着色(一个面着色一次)在三角形内部并不会发生颜色的变化
  - Gouraud Shading 在每个三角形的顶点上进行一次着色,然后三角形内部的颜色为三个顶点的插值,这样三角形内部的颜色就会有一个渐变的效果，也能够更加平滑。
  - Phong Shading 在每一个像素上都可以求得一个独特的法向量,然后就可以在每一个像素都进行一个着色,这样就可以得到一个相对比较好的结果。即是在每一个像素上都进行一次着色。
  
- 法线如何计算
  - 根据面片的顶点信息可计算出改面片的法线
  - 每一个顶点就会和许多不同的三角形有所关联，即一个顶点就是多个三角形的顶点，所以我们就认为这个顶点的法线就是周围相邻的几个面的法线的平均。
	每个三角形的面积作为权值，对每个法向量进行加权平均，并且在求平均时要对向量进行标准化
  - 依赖三角形三个顶点法线,根据重心坐标可计算出三角形中每个像素的法线
  
- unity中设置环境光
  - Window -> Lighting -> Ambient Source / Ambient Color / Ambient Intensity 来设置环境光的颜色和强度
  - 在shader中通过unity内置的变量UNITY_LIGHTMODEL_AMBIENT来获取颜色和强度的信息 fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;
  
- 自发光
  - 大多数物体没有自发光属性,如果要计算自发光只需要在片元着色器输出最后颜色之前,把材质的自发光颜色添加到输出颜色上即可
  
- 逐顶点漫反射
  - 定义漫反射颜色属性 Properties{ _Diffuse("Diffuse",Color) = (1,1,1,1)}
  - 在顶点着色器中
	- 计算出该顶点在世界空间的法线 fixed3 worldNormal = normalize(mul(v.normal,float(3x3)_World2Object));
	- 根据unity内置变量获取到当前光源在世界空间方向 fixed3 worldLight = normalize(_World2SpaceLightPos0.xyz);
	- 根据该顶点的法线与光线方向夹角的余弦算出漫反射的颜色 fixed3 diffuse = _LightCorlor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal,worldLight));
	- 返回位置和颜色信息给像素着色器使用 o.color = ambient + diffuse;
  - 像素着色器中
	- 直接返回从顶点着色器获取的信息 return fixed4(i.color,1.0);
  

	
	
	
	
	
	